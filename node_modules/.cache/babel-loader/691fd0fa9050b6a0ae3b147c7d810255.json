{"ast":null,"code":"import _classCallCheck from \"C:\\\\Users\\\\\\u800D\\u5EE2\\u793E\\\\Desktop\\\\MyProject\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\\\u800D\\u5EE2\\u793E\\\\Desktop\\\\MyProject\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\\\u800D\\u5EE2\\u793E\\\\Desktop\\\\MyProject\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\\\u800D\\u5EE2\\u793E\\\\Desktop\\\\MyProject\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\\\u800D\\u5EE2\\u793E\\\\Desktop\\\\MyProject\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"C:\\\\Users\\\\\\u800D\\u5EE2\\u793E\\\\Desktop\\\\MyProject\\\\src\\\\components\\\\Classpage\\\\Progresspage.js\";\nimport React, { Component } from 'react';\nimport Button from '@material-ui/core/Button';\nimport Upload from '@material-ui/icons/CreateNewFolderRounded';\nimport { withStyles } from '@material-ui/core/styles'; // import { fromJS, List, Map } from 'immutable'\n\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper';\nimport XLSX from 'xlsx';\nimport { fetchPostSchedule } from '../../api';\nimport Airtable from 'airtable';\nvar TABLE_NAME = 'Schedule';\nvar base = new Airtable({\n  apiKey: 'keyA7EKdngjou4Dgy'\n}).base('appcXtOTPnE4QWIIt');\nvar table = base(TABLE_NAME);\n\nvar styles = function styles(theme) {\n  return {\n    button: {\n      backgroundColor: '#111B24',\n      color: 'white'\n    },\n    UploadIcon: {\n      margin: '0 auto'\n    },\n    input: {\n      position: 'absolute',\n      width: '100%',\n      height: '100%',\n      top: 0,\n      left: 0,\n      outline: 'none',\n      opacity: 0\n    },\n    root: {\n      width: '100%',\n      marginTop: theme.spacing.unit * 3,\n      overflowX: 'auto',\n      backgroundColor: '#212832',\n      border: 'white 1px solid'\n    },\n    head: {\n      fontSize: '14pt',\n      color: '#FFBF5F'\n    },\n    content: {\n      fontSize: '14pt'\n    },\n    editButton: {\n      border: '#FFBF5F 1px solid',\n      float: 'right',\n      marginLeft: theme.spacing.unit * 2\n    }\n  };\n};\n\nvar id = 0;\n\nfunction createData(date, origin, real, class_id) {\n  id += 1;\n  return {\n    id: id,\n    date: date,\n    origin: origin,\n    real: real,\n    class_id: class_id\n  };\n}\n\nvar Progresspage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Progresspage, _Component);\n\n  function Progresspage() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Progresspage);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Progresspage)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      rows: [],\n      noClick: false,\n      rowsInit: [],\n      class_id: ''\n    };\n\n    _this.handleClick = function () {\n      if (_this.state.rows !== \"\") {\n        for (var index = 0; index < _this.state.rows.length; index++) {\n          var data = {\n            fields: {\n              class_id: {},\n              schedule_date: {},\n              schedule_expect: {}\n            }\n          };\n          data.fields.schedule_date = _this.state.rows[index].date;\n          data.fields.schedule_expect = _this.state.rows[index].origin;\n          data.fields.class_id = _this.state.class_id;\n          fetchPostSchedule(data);\n        }\n      }\n    };\n\n    _this.onImportExcel = function (file) {\n      var files = file.target.files;\n      var fileReader = new FileReader();\n\n      fileReader.onload = function (event) {\n        try {\n          var result = event.target.result;\n          var workbook = XLSX.read(result, {\n            type: 'binary'\n          });\n          var data = [];\n\n          for (var sheet in workbook.Sheets) {\n            if (workbook.Sheets.hasOwnProperty(sheet)) {\n              data = data.concat(XLSX.utils.sheet_to_json(workbook.Sheets[sheet])); // break;\n            }\n          }\n\n          _this.setState({\n            data: data\n          });\n\n          var progress_date = _this.state.data.map(function (data, index) {\n            return data['progress_date'];\n          });\n\n          var progress_origin = _this.state.data.map(function (data, index) {\n            return data['progress_origin'];\n          });\n\n          var progress_real = _this.state.data.map(function (data, index) {\n            return data['progress_real'];\n          }); // for (var index = 0; index < progress_date.length; index++) {\n          //     data.push(createData(progress_date[index], progress_origin[index], progress_real[index]));\n          // }               \n\n\n          _this.setState({\n            rows: data\n          }); // console.log(data[0]);\n          // console.log(data[0].date);\n          // console.log(data[0].origin);\n\n        } catch (e) {// message.error('文件類型不正确！');\n        }\n      };\n\n      fileReader.readAsBinaryString(files[0]);\n    };\n\n    return _this;\n  }\n\n  _createClass(Progresspage, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps.class_id !== this.state.class_id) {\n        var count = this.state.rowsInit.length;\n        var temp = [];\n\n        for (var index = 0; index < count; index++) {\n          if (nextProps.class_id === this.state.rowsInit[index].class_id) {\n            temp.push(this.state.rowsInit[index]);\n            this.setState({\n              rows: temp\n            });\n          }\n        }\n\n        this.setState({\n          class_id: nextProps.class_id\n        });\n      }\n    } //airtable\n\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      table.select({\n        //filterByFormula: fileterSentence,\n        view: \"Grid view\" //maxRecords: 1\n\n      }).eachPage(function (records, fetchNextPage) {\n        _this2.setState({\n          records: records\n        });\n\n        var schedule_date = _this2.state.records.map(function (record, index) {\n          return record.fields['schedule_date'];\n        });\n\n        var schedule_expect = _this2.state.records.map(function (record, index) {\n          return record.fields['schedule_expect'];\n        });\n\n        var schedule_real = _this2.state.records.map(function (record, index) {\n          return record.fields['schedule_real'];\n        });\n\n        var class_id = _this2.state.records.map(function (record, index) {\n          return record.fields['class_id'];\n        });\n\n        var temp = [];\n\n        for (var index = 0; index < schedule_date.length; index++) {\n          temp.push(createData(schedule_date[index], schedule_expect[index], schedule_real[index], class_id[index]));\n        }\n\n        _this2.setState({\n          rows: temp\n        });\n\n        _this2.setState({\n          rowsInit: temp\n        });\n\n        fetchNextPage();\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var classes = this.props.classes;\n      var _this$state = this.state,\n          rows = _this$state.rows,\n          noClick = _this$state.noClick;\n      return React.createElement(\"div\", {\n        style: {\n          borderColor: '#FFBF5F'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, React.createElement(Button, {\n        disabled: noClick,\n        className: classes.button,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, React.createElement(Upload, {\n        type: \"upload\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        className: classes.input,\n        type: \"file\",\n        accept: \".xlsx, .xls\",\n        onChange: this.onImportExcel,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }), React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165\n        },\n        __self: this\n      }, \"\\u532F\\u5165\\u6559\\u5B78\\u9032\\u5EA6\")), React.createElement(Button, {\n        className: classes.editButton,\n        onClick: this.handleClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      }, \"\\u5132\\u5B58\"), React.createElement(Paper, {\n        className: classes.root,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170\n        },\n        __self: this\n      }, React.createElement(Table, {\n        className: classes.table,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, React.createElement(TableHead, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      }, React.createElement(TableRow, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }, React.createElement(TableCell, {\n        className: classes.head,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, \"\\u65E5\\u671F\"), React.createElement(TableCell, {\n        className: classes.head,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175\n        },\n        __self: this\n      }, \"\\u9810\\u5148\\u6392\\u5B9A\\u9032\\u5EA6\"), React.createElement(TableCell, {\n        className: classes.head,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176\n        },\n        __self: this\n      }, \"\\u5BE6\\u969B\\u6559\\u6388\\u9032\\u5EA6\"))), React.createElement(TableBody, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      }, rows.map(function (row) {\n        return React.createElement(TableRow, {\n          key: row.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181\n          },\n          __self: this\n        }, React.createElement(TableCell, {\n          className: classes.content,\n          style: {\n            width: '20%'\n          },\n          component: \"th\",\n          scope: \"row\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 182\n          },\n          __self: this\n        }, row.date), React.createElement(TableCell, {\n          className: classes.content,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 183\n          },\n          __self: this\n        }, row.origin), React.createElement(TableCell, {\n          className: classes.content,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 184\n          },\n          __self: this\n        }, row.real));\n      })))));\n    }\n  }]);\n\n  return Progresspage;\n}(Component);\n\nexport default withStyles(styles)(Progresspage);\n{\n  /* {\r\n                     data.length ?\r\n                         <ul>\r\n                             {data.map((el, index) => (\r\n                                 <li key={index}>{el.name}</li>\r\n                             ))}\r\n                         </ul> :\r\n                         <div>\r\n                             <input\r\n                                 accept=\"image/*\"\r\n                                 className={classes.input}\r\n                                 id=\"contained-button-file\"\r\n                                 multiple\r\n                                 type=\"file\"\r\n                             />\r\n                             <label htmlFor=\"contained-button-file\">\r\n                                 <Button variant=\"contained\" component=\"span\" className={classes.button}>\r\n                                     <Upload className={classes.UploadIcon} />\r\n                                     匯入學生資料\r\n                         </Button>\r\n                             </label>\r\n                         </div>\r\n                 } */\n}","map":{"version":3,"sources":["C:\\Users\\耍廢社\\Desktop\\MyProject\\src\\components\\Classpage\\Progresspage.js"],"names":["React","Component","Button","Upload","withStyles","Table","TableBody","TableCell","TableHead","TableRow","Paper","XLSX","fetchPostSchedule","Airtable","TABLE_NAME","base","apiKey","table","styles","theme","button","backgroundColor","color","UploadIcon","margin","input","position","width","height","top","left","outline","opacity","root","marginTop","spacing","unit","overflowX","border","head","fontSize","content","editButton","float","marginLeft","id","createData","date","origin","real","class_id","Progresspage","state","rows","noClick","rowsInit","handleClick","index","length","data","fields","schedule_date","schedule_expect","onImportExcel","file","files","target","fileReader","FileReader","onload","event","result","workbook","read","type","sheet","Sheets","hasOwnProperty","concat","utils","sheet_to_json","setState","progress_date","map","progress_origin","progress_real","e","readAsBinaryString","nextProps","count","temp","push","select","view","eachPage","records","fetchNextPage","record","schedule_real","classes","props","borderColor","row"],"mappings":";;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,OAAOC,MAAP,MAAmB,2CAAnB;AACA,SAASC,UAAT,QAA2B,0BAA3B,C,CACA;;AACA,OAAOC,KAAP,MAAkB,yBAAlB;AACA,OAAOC,SAAP,MAAsB,6BAAtB;AACA,OAAOC,SAAP,MAAsB,6BAAtB;AACA,OAAOC,SAAP,MAAsB,6BAAtB;AACA,OAAOC,QAAP,MAAqB,4BAArB;AACA,OAAOC,KAAP,MAAkB,yBAAlB;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,SAASC,iBAAT,QAAkC,WAAlC;AACA,OAAOC,QAAP,MAAqB,UAArB;AAEA,IAAMC,UAAU,GAAG,UAAnB;AACA,IAAMC,IAAI,GAAG,IAAIF,QAAJ,CAAa;AAAEG,EAAAA,MAAM,EAAE;AAAV,CAAb,EAA8CD,IAA9C,CAAmD,mBAAnD,CAAb;AACA,IAAME,KAAK,GAAGF,IAAI,CAACD,UAAD,CAAlB;;AAEA,IAAMI,MAAM,GAAG,SAATA,MAAS,CAAAC,KAAK;AAAA,SAAK;AACrBC,IAAAA,MAAM,EAAE;AACJC,MAAAA,eAAe,EAAE,SADb;AAEJC,MAAAA,KAAK,EAAE;AAFH,KADa;AAKrBC,IAAAA,UAAU,EAAE;AACRC,MAAAA,MAAM,EAAE;AADA,KALS;AAQrBC,IAAAA,KAAK,EAAE;AACHC,MAAAA,QAAQ,EAAE,UADP;AAEHC,MAAAA,KAAK,EAAE,MAFJ;AAGHC,MAAAA,MAAM,EAAE,MAHL;AAIHC,MAAAA,GAAG,EAAE,CAJF;AAKHC,MAAAA,IAAI,EAAE,CALH;AAMHC,MAAAA,OAAO,EAAE,MANN;AAOHC,MAAAA,OAAO,EAAE;AAPN,KARc;AAiBrBC,IAAAA,IAAI,EAAE;AACFN,MAAAA,KAAK,EAAE,MADL;AAEFO,MAAAA,SAAS,EAAEf,KAAK,CAACgB,OAAN,CAAcC,IAAd,GAAqB,CAF9B;AAGFC,MAAAA,SAAS,EAAE,MAHT;AAIFhB,MAAAA,eAAe,EAAE,SAJf;AAKFiB,MAAAA,MAAM,EAAE;AALN,KAjBe;AAwBrBC,IAAAA,IAAI,EAAE;AACFC,MAAAA,QAAQ,EAAE,MADR;AAEFlB,MAAAA,KAAK,EAAE;AAFL,KAxBe;AA4BrBmB,IAAAA,OAAO,EAAE;AACLD,MAAAA,QAAQ,EAAE;AADL,KA5BY;AA+BrBE,IAAAA,UAAU,EAAE;AACRJ,MAAAA,MAAM,EAAE,mBADA;AAERK,MAAAA,KAAK,EAAE,OAFC;AAGRC,MAAAA,UAAU,EAAEzB,KAAK,CAACgB,OAAN,CAAcC,IAAd,GAAqB;AAHzB;AA/BS,GAAL;AAAA,CAApB;;AAsCA,IAAIS,EAAE,GAAG,CAAT;;AACA,SAASC,UAAT,CAAoBC,IAApB,EAA0BC,MAA1B,EAAkCC,IAAlC,EAAwCC,QAAxC,EAAkD;AAC9CL,EAAAA,EAAE,IAAI,CAAN;AACA,SAAO;AAAEA,IAAAA,EAAE,EAAFA,EAAF;AAAME,IAAAA,IAAI,EAAJA,IAAN;AAAYC,IAAAA,MAAM,EAANA,MAAZ;AAAoBC,IAAAA,IAAI,EAAJA,IAApB;AAA0BC,IAAAA,QAAQ,EAARA;AAA1B,GAAP;AACH;;IAEKC,Y;;;;;;;;;;;;;;;;;UACFC,K,GAAQ;AACJC,MAAAA,IAAI,EAAE,EADF;AAEJC,MAAAA,OAAO,EAAE,KAFL;AAGJC,MAAAA,QAAQ,EAAE,EAHN;AAIJL,MAAAA,QAAQ,EAAE;AAJN,K;;UA8CRM,W,GAAc,YAAM;AAChB,UAAI,MAAKJ,KAAL,CAAWC,IAAX,KAAoB,EAAxB,EAA4B;AAExB,aAAK,IAAII,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG,MAAKL,KAAL,CAAWC,IAAX,CAAgBK,MAA5C,EAAoDD,KAAK,EAAzD,EAA6D;AACzD,cAAIE,IAAI,GAAG;AAAEC,YAAAA,MAAM,EAAE;AAAEV,cAAAA,QAAQ,EAAE,EAAZ;AAAgBW,cAAAA,aAAa,EAAE,EAA/B;AAAmCC,cAAAA,eAAe,EAAE;AAApD;AAAV,WAAX;AACAH,UAAAA,IAAI,CAACC,MAAL,CAAYC,aAAZ,GAA4B,MAAKT,KAAL,CAAWC,IAAX,CAAgBI,KAAhB,EAAuBV,IAAnD;AACAY,UAAAA,IAAI,CAACC,MAAL,CAAYE,eAAZ,GAA8B,MAAKV,KAAL,CAAWC,IAAX,CAAgBI,KAAhB,EAAuBT,MAArD;AACAW,UAAAA,IAAI,CAACC,MAAL,CAAYV,QAAZ,GAAuB,MAAKE,KAAL,CAAWF,QAAlC;AACAtC,UAAAA,iBAAiB,CAAC+C,IAAD,CAAjB;AACH;AACJ;AACJ,K;;UAEDI,a,GAAgB,UAAAC,IAAI,EAAI;AAAA,UACZC,KADY,GACFD,IAAI,CAACE,MADH,CACZD,KADY;AAEpB,UAAME,UAAU,GAAG,IAAIC,UAAJ,EAAnB;;AACAD,MAAAA,UAAU,CAACE,MAAX,GAAoB,UAAAC,KAAK,EAAI;AACzB,YAAI;AAAA,cACQC,MADR,GACmBD,KAAK,CAACJ,MADzB,CACQK,MADR;AAEA,cAAMC,QAAQ,GAAG7D,IAAI,CAAC8D,IAAL,CAAUF,MAAV,EAAkB;AAAEG,YAAAA,IAAI,EAAE;AAAR,WAAlB,CAAjB;AACA,cAAIf,IAAI,GAAG,EAAX;;AACA,eAAK,IAAMgB,KAAX,IAAoBH,QAAQ,CAACI,MAA7B,EAAqC;AACjC,gBAAIJ,QAAQ,CAACI,MAAT,CAAgBC,cAAhB,CAA+BF,KAA/B,CAAJ,EAA2C;AACvChB,cAAAA,IAAI,GAAGA,IAAI,CAACmB,MAAL,CAAYnE,IAAI,CAACoE,KAAL,CAAWC,aAAX,CAAyBR,QAAQ,CAACI,MAAT,CAAgBD,KAAhB,CAAzB,CAAZ,CAAP,CADuC,CAEvC;AACH;AACJ;;AACD,gBAAKM,QAAL,CAAc;AAAEtB,YAAAA,IAAI,EAAJA;AAAF,WAAd;;AACA,cAAMuB,aAAa,GAAG,MAAK9B,KAAL,CAAWO,IAAX,CAAgBwB,GAAhB,CAAoB,UAACxB,IAAD,EAAOF,KAAP;AAAA,mBAAiBE,IAAI,CAAC,eAAD,CAArB;AAAA,WAApB,CAAtB;;AACA,cAAMyB,eAAe,GAAG,MAAKhC,KAAL,CAAWO,IAAX,CAAgBwB,GAAhB,CAAoB,UAACxB,IAAD,EAAOF,KAAP;AAAA,mBAAiBE,IAAI,CAAC,iBAAD,CAArB;AAAA,WAApB,CAAxB;;AACA,cAAM0B,aAAa,GAAG,MAAKjC,KAAL,CAAWO,IAAX,CAAgBwB,GAAhB,CAAoB,UAACxB,IAAD,EAAOF,KAAP;AAAA,mBAAiBE,IAAI,CAAC,eAAD,CAArB;AAAA,WAApB,CAAtB,CAbA,CAcA;AACA;AACA;;;AACA,gBAAKsB,QAAL,CAAc;AAAE5B,YAAAA,IAAI,EAAEM;AAAR,WAAd,EAjBA,CAmBA;AACA;AACA;;AACH,SAtBD,CAsBE,OAAO2B,CAAP,EAAU,CACR;AACH;AACJ,OA1BD;;AA2BAnB,MAAAA,UAAU,CAACoB,kBAAX,CAA8BtB,KAAK,CAAC,CAAD,CAAnC;AACH,K;;;;;;;8CApFyBuB,S,EAAW;AACjC,UAAIA,SAAS,CAACtC,QAAV,KAAuB,KAAKE,KAAL,CAAWF,QAAtC,EAAgD;AAC5C,YAAIuC,KAAK,GAAG,KAAKrC,KAAL,CAAWG,QAAX,CAAoBG,MAAhC;AACA,YAAIgC,IAAI,GAAG,EAAX;;AACA,aAAK,IAAIjC,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGgC,KAA5B,EAAmChC,KAAK,EAAxC,EAA4C;AACxC,cAAI+B,SAAS,CAACtC,QAAV,KAAuB,KAAKE,KAAL,CAAWG,QAAX,CAAoBE,KAApB,EAA2BP,QAAtD,EAAgE;AAC5DwC,YAAAA,IAAI,CAACC,IAAL,CAAU,KAAKvC,KAAL,CAAWG,QAAX,CAAoBE,KAApB,CAAV;AACA,iBAAKwB,QAAL,CAAc;AAAE5B,cAAAA,IAAI,EAAEqC;AAAR,aAAd;AACH;AACJ;;AACD,aAAKT,QAAL,CAAc;AAAE/B,UAAAA,QAAQ,EAAEsC,SAAS,CAACtC;AAAtB,SAAd;AACH;AACJ,K,CAED;;;;wCACoB;AAAA;;AAEhBjC,MAAAA,KAAK,CAAC2E,MAAN,CAAa;AACT;AACAC,QAAAA,IAAI,EAAE,WAFG,CAGT;;AAHS,OAAb,EAIGC,QAJH,CAIY,UAACC,OAAD,EAAUC,aAAV,EAA4B;AACpC,QAAA,MAAI,CAACf,QAAL,CAAc;AAAEc,UAAAA,OAAO,EAAPA;AAAF,SAAd;;AAEA,YAAMlC,aAAa,GAAG,MAAI,CAACT,KAAL,CAAW2C,OAAX,CAAmBZ,GAAnB,CAAuB,UAACc,MAAD,EAASxC,KAAT;AAAA,iBAAmBwC,MAAM,CAACrC,MAAP,CAAc,eAAd,CAAnB;AAAA,SAAvB,CAAtB;;AACA,YAAME,eAAe,GAAG,MAAI,CAACV,KAAL,CAAW2C,OAAX,CAAmBZ,GAAnB,CAAuB,UAACc,MAAD,EAASxC,KAAT;AAAA,iBAAmBwC,MAAM,CAACrC,MAAP,CAAc,iBAAd,CAAnB;AAAA,SAAvB,CAAxB;;AACA,YAAMsC,aAAa,GAAG,MAAI,CAAC9C,KAAL,CAAW2C,OAAX,CAAmBZ,GAAnB,CAAuB,UAACc,MAAD,EAASxC,KAAT;AAAA,iBAAmBwC,MAAM,CAACrC,MAAP,CAAc,eAAd,CAAnB;AAAA,SAAvB,CAAtB;;AACA,YAAMV,QAAQ,GAAG,MAAI,CAACE,KAAL,CAAW2C,OAAX,CAAmBZ,GAAnB,CAAuB,UAACc,MAAD,EAASxC,KAAT;AAAA,iBAAmBwC,MAAM,CAACrC,MAAP,CAAc,UAAd,CAAnB;AAAA,SAAvB,CAAjB;;AACA,YAAI8B,IAAI,GAAG,EAAX;;AACA,aAAK,IAAIjC,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGI,aAAa,CAACH,MAA1C,EAAkDD,KAAK,EAAvD,EAA2D;AACvDiC,UAAAA,IAAI,CAACC,IAAL,CAAU7C,UAAU,CAACe,aAAa,CAACJ,KAAD,CAAd,EAAuBK,eAAe,CAACL,KAAD,CAAtC,EAA+CyC,aAAa,CAACzC,KAAD,CAA5D,EAAqEP,QAAQ,CAACO,KAAD,CAA7E,CAApB;AACH;;AAED,QAAA,MAAI,CAACwB,QAAL,CAAc;AAAE5B,UAAAA,IAAI,EAAEqC;AAAR,SAAd;;AACA,QAAA,MAAI,CAACT,QAAL,CAAc;AAAE1B,UAAAA,QAAQ,EAAEmC;AAAZ,SAAd;;AACAM,QAAAA,aAAa;AAChB,OAnBD;AAqBH;;;6BA+CQ;AAAA,UACGG,OADH,GACe,KAAKC,KADpB,CACGD,OADH;AAAA,wBAEqB,KAAK/C,KAF1B;AAAA,UAEGC,IAFH,eAEGA,IAFH;AAAA,UAESC,OAFT,eAESA,OAFT;AAIL,aACI;AAAK,QAAA,KAAK,EAAE;AAAE+C,UAAAA,WAAW,EAAE;AAAf,SAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,MAAD;AAAQ,QAAA,QAAQ,EAAE/C,OAAlB;AAA2B,QAAA,SAAS,EAAE6C,OAAO,CAAC/E,MAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,MAAD;AAAQ,QAAA,IAAI,EAAC,QAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,EAEI;AAAO,QAAA,SAAS,EAAE+E,OAAO,CAAC1E,KAA1B;AAAiC,QAAA,IAAI,EAAC,MAAtC;AAA6C,QAAA,MAAM,EAAC,aAApD;AAAkE,QAAA,QAAQ,EAAE,KAAKsC,aAAjF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFJ,EAGI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gDAHJ,CADJ,EAMI,oBAAC,MAAD;AAAQ,QAAA,SAAS,EAAEoC,OAAO,CAACzD,UAA3B;AAAuC,QAAA,OAAO,EAAE,KAAKc,WAArD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBANJ,EASI,oBAAC,KAAD;AAAO,QAAA,SAAS,EAAE2C,OAAO,CAAClE,IAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,KAAD;AAAO,QAAA,SAAS,EAAEkE,OAAO,CAAClF,KAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI,oBAAC,SAAD;AAAW,QAAA,SAAS,EAAEkF,OAAO,CAAC5D,IAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADJ,EAEI,oBAAC,SAAD;AAAW,QAAA,SAAS,EAAE4D,OAAO,CAAC5D,IAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gDAFJ,EAGI,oBAAC,SAAD;AAAW,QAAA,SAAS,EAAE4D,OAAO,CAAC5D,IAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gDAHJ,CADJ,CADJ,EAQI,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACKc,IAAI,CAAC8B,GAAL,CAAS,UAAAmB,GAAG;AAAA,eACT,oBAAC,QAAD;AAAU,UAAA,GAAG,EAAEA,GAAG,CAACzD,EAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI,oBAAC,SAAD;AAAW,UAAA,SAAS,EAAEsD,OAAO,CAAC1D,OAA9B;AAAuC,UAAA,KAAK,EAAE;AAAEd,YAAAA,KAAK,EAAE;AAAT,WAA9C;AAAgE,UAAA,SAAS,EAAC,IAA1E;AAA+E,UAAA,KAAK,EAAC,KAArF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAA4F2E,GAAG,CAACvD,IAAhG,CADJ,EAEI,oBAAC,SAAD;AAAW,UAAA,SAAS,EAAEoD,OAAO,CAAC1D,OAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAwC6D,GAAG,CAACtD,MAA5C,CAFJ,EAGI,oBAAC,SAAD;AAAW,UAAA,SAAS,EAAEmD,OAAO,CAAC1D,OAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAwC6D,GAAG,CAACrD,IAA5C,CAHJ,CADS;AAAA,OAAZ,CADL,CARJ,CADJ,CATJ,CADJ;AAiCH;;;;EAjIsBhD,S;;AAoI3B,eAAeG,UAAU,CAACc,MAAD,CAAV,CAAmBiC,YAAnB,CAAf;AAGA;AAAC;;;;;;;;;;;;;;;;;;;;;;;AAsBoB","sourcesContent":["import React, { Component } from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport Upload from '@material-ui/icons/CreateNewFolderRounded';\r\nimport { withStyles } from '@material-ui/core/styles';\r\n// import { fromJS, List, Map } from 'immutable'\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TableRow from '@material-ui/core/TableRow';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport XLSX from 'xlsx';\r\nimport { fetchPostSchedule } from '../../api';\r\nimport Airtable from 'airtable';\r\n\r\nconst TABLE_NAME = 'Schedule';\r\nconst base = new Airtable({ apiKey: 'keyA7EKdngjou4Dgy' }).base('appcXtOTPnE4QWIIt');\r\nconst table = base(TABLE_NAME);\r\n\r\nconst styles = theme => ({\r\n    button: {\r\n        backgroundColor: '#111B24',\r\n        color: 'white',\r\n    },\r\n    UploadIcon: {\r\n        margin: '0 auto',\r\n    },\r\n    input: {\r\n        position: 'absolute',\r\n        width: '100%',\r\n        height: '100%',\r\n        top: 0,\r\n        left: 0,\r\n        outline: 'none',\r\n        opacity: 0,\r\n    },\r\n    root: {\r\n        width: '100%',\r\n        marginTop: theme.spacing.unit * 3,\r\n        overflowX: 'auto',\r\n        backgroundColor: '#212832',\r\n        border: 'white 1px solid',\r\n    },\r\n    head: {\r\n        fontSize: '14pt',\r\n        color: '#FFBF5F',\r\n    },\r\n    content: {\r\n        fontSize: '14pt',\r\n    },\r\n    editButton: {\r\n        border: '#FFBF5F 1px solid',\r\n        float: 'right',\r\n        marginLeft: theme.spacing.unit * 2,\r\n    }\r\n});\r\n\r\nlet id = 0;\r\nfunction createData(date, origin, real, class_id) {\r\n    id += 1;\r\n    return { id, date, origin, real, class_id };\r\n}\r\n\r\nclass Progresspage extends Component {\r\n    state = {\r\n        rows: [],\r\n        noClick: false,\r\n        rowsInit: [],\r\n        class_id: '',\r\n    }\r\n    componentWillReceiveProps(nextProps) {\r\n        if (nextProps.class_id !== this.state.class_id) {\r\n            var count = this.state.rowsInit.length;\r\n            var temp = [];\r\n            for (var index = 0; index < count; index++) {\r\n                if (nextProps.class_id === this.state.rowsInit[index].class_id) {\r\n                    temp.push(this.state.rowsInit[index]);\r\n                    this.setState({ rows: temp });\r\n                }\r\n            }\r\n            this.setState({ class_id: nextProps.class_id });\r\n        }\r\n    }\r\n\r\n    //airtable\r\n    componentDidMount() {\r\n\r\n        table.select({\r\n            //filterByFormula: fileterSentence,\r\n            view: \"Grid view\",\r\n            //maxRecords: 1\r\n        }).eachPage((records, fetchNextPage) => {\r\n            this.setState({ records });\r\n\r\n            const schedule_date = this.state.records.map((record, index) => record.fields['schedule_date']);\r\n            const schedule_expect = this.state.records.map((record, index) => record.fields['schedule_expect']);\r\n            const schedule_real = this.state.records.map((record, index) => record.fields['schedule_real']);\r\n            const class_id = this.state.records.map((record, index) => record.fields['class_id']);\r\n            var temp = [];\r\n            for (var index = 0; index < schedule_date.length; index++) {\r\n                temp.push(createData(schedule_date[index], schedule_expect[index], schedule_real[index], class_id[index]));\r\n            }\r\n\r\n            this.setState({ rows: temp });\r\n            this.setState({ rowsInit: temp });\r\n            fetchNextPage();\r\n        }\r\n        );\r\n    }\r\n\r\n    handleClick = () => {\r\n        if (this.state.rows !== \"\") {\r\n\r\n            for (var index = 0; index < this.state.rows.length; index++) {\r\n                let data = { fields: { class_id: {}, schedule_date: {}, schedule_expect: {} } };\r\n                data.fields.schedule_date = this.state.rows[index].date;\r\n                data.fields.schedule_expect = this.state.rows[index].origin;\r\n                data.fields.class_id = this.state.class_id;\r\n                fetchPostSchedule(data);\r\n            }\r\n        }\r\n    }\r\n\r\n    onImportExcel = file => {\r\n        const { files } = file.target;\r\n        const fileReader = new FileReader();\r\n        fileReader.onload = event => {\r\n            try {\r\n                const { result } = event.target;\r\n                const workbook = XLSX.read(result, { type: 'binary' });\r\n                let data = [];\r\n                for (const sheet in workbook.Sheets) {\r\n                    if (workbook.Sheets.hasOwnProperty(sheet)) {\r\n                        data = data.concat(XLSX.utils.sheet_to_json(workbook.Sheets[sheet]));\r\n                        // break;\r\n                    }\r\n                }\r\n                this.setState({ data });\r\n                const progress_date = this.state.data.map((data, index) => data['progress_date']);\r\n                const progress_origin = this.state.data.map((data, index) => data['progress_origin']);\r\n                const progress_real = this.state.data.map((data, index) => data['progress_real']);\r\n                // for (var index = 0; index < progress_date.length; index++) {\r\n                //     data.push(createData(progress_date[index], progress_origin[index], progress_real[index]));\r\n                // }               \r\n                this.setState({ rows: data });\r\n\r\n                // console.log(data[0]);\r\n                // console.log(data[0].date);\r\n                // console.log(data[0].origin);\r\n            } catch (e) {\r\n                // message.error('文件類型不正确！');\r\n            }\r\n        };\r\n        fileReader.readAsBinaryString(files[0]);\r\n    }\r\n    render() {\r\n        const { classes } = this.props;\r\n        const { rows, noClick } = this.state;\r\n\r\n        return (\r\n            <div style={{ borderColor: '#FFBF5F' }}>\r\n                <Button disabled={noClick} className={classes.button}>\r\n                    <Upload type='upload' />\r\n                    <input className={classes.input} type='file' accept='.xlsx, .xls' onChange={this.onImportExcel} />\r\n                    <span>匯入教學進度</span>\r\n                </Button>\r\n                <Button className={classes.editButton} onClick={this.handleClick}>\r\n                    儲存\r\n                </Button>\r\n                <Paper className={classes.root}>\r\n                    <Table className={classes.table}>\r\n                        <TableHead >\r\n                            <TableRow>\r\n                                <TableCell className={classes.head}>日期</TableCell>\r\n                                <TableCell className={classes.head} >預先排定進度</TableCell>\r\n                                <TableCell className={classes.head} >實際教授進度</TableCell>\r\n                            </TableRow>\r\n                        </TableHead>\r\n                        <TableBody>\r\n                            {rows.map(row => (\r\n                                <TableRow key={row.id}>\r\n                                    <TableCell className={classes.content} style={{ width: '20%' }} component=\"th\" scope=\"row\">{row.date}</TableCell>\r\n                                    <TableCell className={classes.content}>{row.origin}</TableCell>\r\n                                    <TableCell className={classes.content}>{row.real}</TableCell>\r\n                                </TableRow>\r\n                            ))}\r\n                        </TableBody>\r\n                    </Table>\r\n                </Paper>\r\n\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(Progresspage);\r\n\r\n\r\n{/* {\r\n                    data.length ?\r\n                        <ul>\r\n                            {data.map((el, index) => (\r\n                                <li key={index}>{el.name}</li>\r\n                            ))}\r\n                        </ul> :\r\n                        <div>\r\n                            <input\r\n                                accept=\"image/*\"\r\n                                className={classes.input}\r\n                                id=\"contained-button-file\"\r\n                                multiple\r\n                                type=\"file\"\r\n                            />\r\n                            <label htmlFor=\"contained-button-file\">\r\n                                <Button variant=\"contained\" component=\"span\" className={classes.button}>\r\n                                    <Upload className={classes.UploadIcon} />\r\n                                    匯入學生資料\r\n                        </Button>\r\n                            </label>\r\n                        </div>\r\n                } */}"]},"metadata":{},"sourceType":"module"}